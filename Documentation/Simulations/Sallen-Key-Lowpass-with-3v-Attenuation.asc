Version 4
SHEET 1 2292 2424
WIRE -16 96 -144 96
WIRE 192 96 48 96
WIRE -688 144 -688 80
WIRE 112 192 112 160
WIRE 80 208 0 208
WIRE 192 224 192 96
WIRE 192 224 144 224
WIRE 240 224 192 224
WIRE 336 224 304 224
WIRE 368 224 336 224
WIRE -688 240 -688 224
WIRE -560 240 -688 240
WIRE -240 240 -384 240
WIRE -144 240 -144 96
WIRE -144 240 -160 240
WIRE -128 240 -144 240
WIRE 0 240 0 208
WIRE 0 240 -48 240
WIRE 80 240 48 240
WIRE -688 272 -688 240
WIRE 0 288 0 240
WIRE -384 304 -384 240
WIRE 48 304 48 240
WIRE 192 304 192 224
WIRE 192 304 48 304
WIRE 336 304 336 224
WIRE 112 352 112 256
WIRE -688 384 -688 352
WIRE 0 384 0 352
WIRE 336 400 336 384
WIRE -384 432 -384 384
WIRE 448 576 240 576
WIRE -656 592 -864 592
WIRE 768 592 640 592
WIRE 976 592 832 592
WIRE -336 608 -464 608
WIRE -128 608 -272 608
WIRE -656 640 -656 592
WIRE 896 688 896 656
WIRE -208 704 -208 672
WIRE 864 704 784 704
WIRE -240 720 -320 720
WIRE 976 720 976 592
WIRE 976 720 928 720
WIRE 1024 720 976 720
WIRE 1120 720 1088 720
WIRE 1152 720 1120 720
WIRE -128 736 -128 608
WIRE -128 736 -176 736
WIRE -80 736 -128 736
WIRE 16 736 -16 736
WIRE 48 736 16 736
WIRE 448 736 448 576
WIRE 544 736 448 736
WIRE 640 736 640 592
WIRE 640 736 624 736
WIRE 656 736 640 736
WIRE 784 736 784 704
WIRE 784 736 736 736
WIRE 864 736 832 736
WIRE -656 752 -656 720
WIRE -560 752 -656 752
WIRE -464 752 -464 608
WIRE -464 752 -480 752
WIRE -448 752 -464 752
WIRE -320 752 -320 720
WIRE -320 752 -368 752
WIRE -240 752 -272 752
WIRE 240 752 240 576
WIRE -864 768 -864 592
WIRE 448 768 448 736
WIRE 1120 768 1120 720
WIRE -656 784 -656 752
WIRE 16 784 16 736
WIRE 784 784 784 736
WIRE -320 800 -320 752
WIRE 832 800 832 736
WIRE 976 800 976 720
WIRE 976 800 832 800
WIRE -272 816 -272 752
WIRE -128 816 -128 736
WIRE -128 816 -272 816
WIRE 896 848 896 752
WIRE -208 864 -208 768
WIRE 240 880 240 832
WIRE 784 880 784 848
WIRE -864 896 -864 848
WIRE -320 896 -320 864
WIRE 448 896 448 848
WIRE -656 912 -656 864
WIRE 688 1184 480 1184
WIRE -752 1200 -960 1200
WIRE 1008 1200 880 1200
WIRE 1216 1200 1072 1200
WIRE -432 1216 -560 1216
WIRE -224 1216 -368 1216
WIRE 1136 1296 1136 1264
WIRE -304 1312 -304 1280
WIRE 1104 1312 1024 1312
WIRE -336 1328 -416 1328
WIRE 1216 1328 1216 1200
WIRE 1216 1328 1168 1328
WIRE 1264 1328 1216 1328
WIRE 1376 1328 1328 1328
WIRE 1504 1328 1456 1328
WIRE 1632 1328 1504 1328
WIRE 1664 1328 1632 1328
WIRE -224 1344 -224 1216
WIRE -224 1344 -272 1344
WIRE -176 1344 -224 1344
WIRE -64 1344 -112 1344
WIRE 64 1344 16 1344
WIRE 192 1344 64 1344
WIRE 224 1344 192 1344
WIRE 688 1344 688 1184
WIRE 784 1344 688 1344
WIRE 880 1344 880 1200
WIRE 880 1344 864 1344
WIRE 896 1344 880 1344
WIRE 1024 1344 1024 1312
WIRE 1024 1344 976 1344
WIRE 1104 1344 1072 1344
WIRE -752 1360 -752 1200
WIRE -656 1360 -752 1360
WIRE -560 1360 -560 1216
WIRE -560 1360 -576 1360
WIRE -544 1360 -560 1360
WIRE -416 1360 -416 1328
WIRE -416 1360 -464 1360
WIRE -336 1360 -368 1360
WIRE 480 1360 480 1184
WIRE -960 1376 -960 1200
WIRE 1632 1376 1632 1328
WIRE 192 1392 192 1344
WIRE 1024 1392 1024 1344
WIRE 1504 1392 1504 1328
WIRE -416 1408 -416 1360
WIRE 64 1408 64 1344
WIRE 1072 1408 1072 1344
WIRE 1216 1408 1216 1328
WIRE 1216 1408 1072 1408
WIRE -368 1424 -368 1360
WIRE -224 1424 -224 1344
WIRE -224 1424 -368 1424
WIRE 1136 1456 1136 1360
WIRE -304 1472 -304 1376
WIRE 480 1488 480 1440
WIRE 1024 1488 1024 1456
WIRE -960 1504 -960 1456
WIRE -416 1504 -416 1472
WIRE 1504 1504 1504 1472
WIRE 64 1520 64 1488
WIRE 960 1808 752 1808
WIRE 1280 1824 1152 1824
WIRE 1488 1824 1344 1824
WIRE -656 1840 -864 1840
WIRE -336 1856 -464 1856
WIRE -128 1856 -272 1856
WIRE 1408 1920 1408 1888
WIRE 1376 1936 1296 1936
WIRE -208 1952 -208 1920
WIRE 1488 1952 1488 1824
WIRE 1488 1952 1440 1952
WIRE 1536 1952 1488 1952
WIRE 1648 1952 1600 1952
WIRE 1776 1952 1728 1952
WIRE 1856 1952 1776 1952
WIRE 2000 1952 1936 1952
WIRE 2032 1952 2000 1952
WIRE -240 1968 -320 1968
WIRE 288 1968 288 1936
WIRE 960 1968 960 1808
WIRE 1056 1968 960 1968
WIRE 1152 1968 1152 1824
WIRE 1152 1968 1136 1968
WIRE 1168 1968 1152 1968
WIRE 1296 1968 1296 1936
WIRE 1296 1968 1248 1968
WIRE 1376 1968 1344 1968
WIRE -128 1984 -128 1856
WIRE -128 1984 -176 1984
WIRE -32 1984 -128 1984
WIRE 96 1984 48 1984
WIRE 256 1984 96 1984
WIRE 752 1984 752 1808
WIRE -656 2000 -656 1840
WIRE -560 2000 -656 2000
WIRE -464 2000 -464 1856
WIRE -464 2000 -480 2000
WIRE -448 2000 -464 2000
WIRE -320 2000 -320 1968
WIRE -320 2000 -368 2000
WIRE -240 2000 -272 2000
WIRE 368 2000 320 2000
WIRE 416 2000 368 2000
WIRE 528 2000 480 2000
WIRE 560 2000 528 2000
WIRE 2000 2000 2000 1952
WIRE -864 2016 -864 1840
WIRE 256 2016 224 2016
WIRE 1296 2016 1296 1968
WIRE 1776 2016 1776 1952
WIRE 1344 2032 1344 1968
WIRE 1488 2032 1488 1952
WIRE 1488 2032 1344 2032
WIRE -320 2048 -320 2000
WIRE 96 2048 96 1984
WIRE 528 2048 528 2000
WIRE -272 2064 -272 2000
WIRE -128 2064 -128 1984
WIRE -128 2064 -272 2064
WIRE 224 2080 224 2016
WIRE 368 2080 368 2000
WIRE 368 2080 224 2080
WIRE 1408 2080 1408 1984
WIRE -208 2112 -208 2016
WIRE 752 2112 752 2064
WIRE 1296 2112 1296 2080
WIRE 288 2128 288 2032
WIRE 1776 2128 1776 2096
WIRE -864 2144 -864 2096
WIRE -320 2144 -320 2112
WIRE 96 2160 96 2128
FLAG -688 80 V+
FLAG -688 384 0
FLAG -560 240 1.8V_REF
FLAG 0 384 1.8V_REF
FLAG -384 432 1.8V_REF
FLAG 368 224 OUT_AUDIO_CAPE
FLAG 336 400 0
FLAG 112 352 0
FLAG 112 160 V+
FLAG -320 896 1.8V_REF
FLAG -864 896 1.8V_REF
FLAG 48 736 OUT_NAIVE
FLAG 16 864 0
FLAG -208 864 0
FLAG -208 672 V+
FLAG -656 912 1.8V_REF
FLAG 784 880 1.8V_REF
FLAG 240 880 1.8V_REF
FLAG 1152 720 OUT_ATT_PRE
FLAG 1120 848 0
FLAG 896 848 0
FLAG 896 656 V+
FLAG 448 896 0
FLAG -416 1504 1.8V_REF
FLAG -960 1504 1.8V_REF
FLAG 224 1344 OUT_ATT_POST1
FLAG 192 1472 0
FLAG -304 1472 0
FLAG -304 1280 V+
FLAG 64 1520 0
FLAG 1024 1488 1.8V_REF
FLAG 480 1488 1.8V_REF
FLAG 1664 1328 OUT_ATT_POST2
FLAG 1632 1456 0
FLAG 1136 1456 0
FLAG 1136 1264 V+
FLAG 1504 1504 0
FLAG -320 2144 1.8V_REF
FLAG -864 2144 1.8V_REF
FLAG 560 2000 OUT_ATT_BUF
FLAG 528 2128 0
FLAG -208 2112 0
FLAG -208 1920 V+
FLAG 96 2160 0
FLAG 288 2128 0
FLAG 288 1936 V+
FLAG 1296 2112 1.8V_REF
FLAG 752 2112 1.8V_REF
FLAG 2032 1952 OUT_ATT_POST1_SER
FLAG 2000 2080 0
FLAG 1408 2080 0
FLAG 1408 1888 V+
FLAG 1776 2128 0
SYMBOL res -32 224 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R1
SYMATTR Value 28.7K
SYMBOL res -144 224 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R2
SYMATTR Value 28.7K
SYMBOL cap -16 288 R0
SYMATTR InstName C1
SYMATTR Value 220pF
SYMBOL cap 48 80 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C2
SYMATTR Value 440pF
SYMBOL cap 304 208 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C3
SYMATTR Value 1µF
SYMBOL voltage -688 128 R0
SYMATTR InstName V1
SYMATTR Value 3.2V
SYMBOL voltage -688 256 R0
SYMATTR InstName V2
SYMATTR Value 1.8V
SYMBOL voltage -384 288 R0
WINDOW 123 24 118 Left 2
WINDOW 39 24 38 Left 2
SYMATTR Value2 AC 2.45V 0
SYMATTR SpiceLine Rser=220
SYMATTR InstName BELA_AOUT
SYMATTR Value ""
SYMBOL res 320 288 R0
SYMATTR InstName LOAD
SYMATTR Value 20k
SYMBOL EL5220C 128 176 R0
SYMATTR InstName U1
SYMBOL res -352 736 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R3
SYMATTR Value 28.7K
SYMBOL res -464 736 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R4
SYMATTR Value 28.7K
SYMBOL cap -336 800 R0
SYMATTR InstName C4
SYMATTR Value 220pF
SYMBOL cap -272 592 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C5
SYMATTR Value 470pF
SYMBOL cap -16 720 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C6
SYMATTR Value 1µF
SYMBOL voltage -864 752 R0
WINDOW 123 24 118 Left 2
WINDOW 39 24 38 Left 2
SYMATTR Value2 AC 2.45V 0
SYMATTR SpiceLine Rser=220
SYMATTR InstName BELA_AOUT1
SYMATTR Value ""
SYMBOL res 0 768 R0
SYMATTR InstName LOAD1
SYMATTR Value 20k
SYMBOL EL5220C -192 688 R0
SYMATTR InstName U2
SYMBOL res -672 624 R0
SYMATTR InstName R5
SYMATTR Value 150K
SYMBOL res -672 768 R0
SYMATTR InstName R6
SYMATTR Value 200K
SYMBOL res 752 720 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R7
SYMATTR Value 28.7K
SYMBOL res 640 720 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R8
SYMATTR Value 28.7K
SYMBOL cap 768 784 R0
SYMATTR InstName C7
SYMATTR Value 220pF
SYMBOL cap 832 576 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C8
SYMATTR Value 470pF
SYMBOL cap 1088 704 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C9
SYMATTR Value 1µF
SYMBOL voltage 240 736 R0
WINDOW 123 24 118 Left 2
WINDOW 39 24 38 Left 2
SYMATTR Value2 AC 2.45V 0
SYMATTR SpiceLine Rser=220
SYMATTR InstName BELA_AOUT2
SYMATTR Value ""
SYMBOL res 1104 752 R0
SYMATTR InstName LOAD2
SYMATTR Value 20k
SYMBOL EL5220C 912 672 R0
SYMATTR InstName U3
SYMBOL res 432 752 R0
SYMATTR InstName R10
SYMATTR Value 390
SYMBOL res -448 1344 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R9
SYMATTR Value 28.7K
SYMBOL res -560 1344 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R11
SYMATTR Value 28.7K
SYMBOL cap -432 1408 R0
SYMATTR InstName C10
SYMATTR Value 220pF
SYMBOL cap -368 1200 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C11
SYMATTR Value 470pF
SYMBOL cap -112 1328 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C12
SYMATTR Value 1µF
SYMBOL voltage -960 1360 R0
WINDOW 123 24 118 Left 2
WINDOW 39 24 38 Left 2
SYMATTR Value2 AC 2.45V 0
SYMATTR SpiceLine Rser=220
SYMATTR InstName BELA_AOUT3
SYMATTR Value ""
SYMBOL res 176 1376 R0
SYMATTR InstName LOAD3
SYMATTR Value 20k
SYMBOL EL5220C -288 1296 R0
SYMATTR InstName U4
SYMBOL res 32 1328 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R12
SYMATTR Value 2.2k
SYMBOL res 48 1392 R0
SYMATTR InstName R13
SYMATTR Value 3.9k
SYMBOL res 992 1328 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R14
SYMATTR Value 28.7K
SYMBOL res 880 1328 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R15
SYMATTR Value 28.7K
SYMBOL cap 1008 1392 R0
SYMATTR InstName C13
SYMATTR Value 220pF
SYMBOL cap 1072 1184 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C14
SYMATTR Value 470pF
SYMBOL cap 1328 1312 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C15
SYMATTR Value 1µF
SYMBOL voltage 480 1344 R0
WINDOW 123 24 118 Left 2
WINDOW 39 24 38 Left 2
SYMATTR Value2 AC 2.45V 0
SYMATTR SpiceLine Rser=220
SYMATTR InstName BELA_AOUT4
SYMATTR Value ""
SYMBOL res 1616 1360 R0
SYMATTR InstName LOAD4
SYMATTR Value 20k
SYMBOL EL5220C 1152 1280 R0
SYMATTR InstName U5
SYMBOL res 1472 1312 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R16
SYMATTR Value 220
SYMBOL res 1488 1376 R0
SYMATTR InstName R17
SYMATTR Value 390
SYMBOL res -352 1984 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R18
SYMATTR Value 28.7K
SYMBOL res -464 1984 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R19
SYMATTR Value 28.7K
SYMBOL cap -336 2048 R0
SYMATTR InstName C16
SYMATTR Value 220pF
SYMBOL cap -272 1840 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C17
SYMATTR Value 470pF
SYMBOL cap 480 1984 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C18
SYMATTR Value 1µF
SYMBOL voltage -864 2000 R0
WINDOW 123 24 118 Left 2
WINDOW 39 24 38 Left 2
SYMATTR Value2 AC 2.45V 0
SYMATTR SpiceLine Rser=220
SYMATTR InstName BELA_AOUT5
SYMATTR Value ""
SYMBOL res 512 2032 R0
SYMATTR InstName LOAD5
SYMATTR Value 20k
SYMBOL EL5220C -192 1936 R0
SYMATTR InstName U6
SYMBOL res 64 1968 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R20
SYMATTR Value 2.2k
SYMBOL res 80 2032 R0
SYMATTR InstName R21
SYMATTR Value 3.9k
SYMBOL EL5220C 304 1952 R0
SYMATTR InstName U7
SYMBOL res 1264 1952 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R22
SYMATTR Value 28.7K
SYMBOL res 1152 1952 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R23
SYMATTR Value 28.7K
SYMBOL cap 1280 2016 R0
SYMATTR InstName C19
SYMATTR Value 220pF
SYMBOL cap 1344 1808 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C20
SYMATTR Value 470pF
SYMBOL cap 1600 1936 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C21
SYMATTR Value 1µF
SYMBOL voltage 752 1968 R0
WINDOW 123 24 118 Left 2
WINDOW 39 24 38 Left 2
SYMATTR Value2 AC 2.45V 0
SYMATTR SpiceLine Rser=220
SYMATTR InstName BELA_AOUT6
SYMATTR Value ""
SYMBOL res 1984 1984 R0
SYMATTR InstName LOAD6
SYMATTR Value 20k
SYMBOL EL5220C 1424 1904 R0
SYMATTR InstName U8
SYMBOL res 1744 1936 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R24
SYMATTR Value 2.2k
SYMBOL res 1760 2000 R0
SYMATTR InstName R25
SYMATTR Value 3.9k
SYMBOL res 1952 1936 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R26
SYMATTR Value 12k
TEXT -816 448 Left 2 !*.op\n*.ac oct 100 1 400 *low frequencies\n.ac oct 100 20 20000 *full frequencies\n*.tran 0 10ms\n*.step param R_LOAD list 1k 20k 100k\n.inc "./models/el5220.txt"
TEXT 512 88 Left 2 ;To the left is a model of the low pass filter used on the Bela audio cape.\nThe input and output signal are ~4.7V peak-to-peak\nThe filter has a cutoff of around 17823.81Hz\nThe original op-amp used in the audio cape is a OPA4348 \n(the ADD8704 is just for the Eagle footprint). \nThe EL5420 is a similar op-amp which could also be used, \nthe most important factor is Rail-to-Rail operation.\nThe analog outputs on the Bela have 220ohm series resistors for protection
TEXT -872 1072 Left 2 ;1st try - make a filter that also attenuates the 0-4.7V signal to 3V peak-2-peak. \nI've swapped the 440pF cap for a more easily sourced 470pF cap.\nThe attenuation is ok, but compare the frequency response to the Audio capelet filter\nThe cutoff is somewhere around 2khz now! And it looks like I've added an extra zero into the curve.
TEXT 232 1056 Left 2 ;2nd try - Andrew's suggestion to simply add a 390ohm resistor to the analog output.\nNow the attenuation is ok and the frequency response is what we want (cutoff ~17khz)\nThe problem here is the power wasted via that small resistor to ground, which could \ndraw up to 8mA of current from the DAC per channel
TEXT -968 1648 Left 2 ;3rd try - Andrew's suggestion to attenuate after the filter.\nThe frequency response is good. But now the attenuation is highly dependent on the\ninput impedence of the load. The Adafruit amp (from what I can tell) has input impedance of 20k.\nThis creates an additional 6% attenuation of the output signal
TEXT 472 1632 Left 2 ;4th try - Using lower value resistors on the output attenuator\nthe attenuation is now more exactly, and less dependent on load impedance. \nBut now we're back to the problem of worst case up to 8mA being drawn by \neach op-amp per channel. The MCP6004 op-amps that we ended up using\ncan deliver up to 20mA, so shouldn't be a problem.
TEXT -872 2272 Left 2 ;5th try - This design attenuates post filter and uses the larger value\nresistors to keep power consumption low. Dependence on the load impedance\nis eliminated using a buffer. \nThis version has low power consumption, good filter behavior, at the expense\nof another op-amp.
TEXT 744 2256 Left 2 ;6th try - Finally, Andrew suggests using the load impedance of the\nAdafruit board to our advantage.\nHe suggests putting a series resistor in line.
